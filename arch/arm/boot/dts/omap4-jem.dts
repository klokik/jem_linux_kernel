/*
 * Author: Mykola Dolhyi <0xb000@gmail.com>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */
/dts-v1/;

#include <dt-bindings/input/input.h>
#include <dt-bindings/input/gpio-keys.h>
#include "omap4470.dtsi"
#include "elpida_ecb240abacn.dtsi"

/ {
	model = "KF OMAP4 Jem Tablet";
	compatible = "amazon,jem", "ti,omap4460", "ti,omap4";

	memory@80000000 {
		device_type = "memory";
		reg = <0x80000000 0x40000000>; /* 1 GB */
	};

	reserved-memory {
		#address-cells = <1>;
		#size-cells = <1>;
		ranges;

		dsp_cma_pool: dsp_cma@98000000 {
			compatible = "shared-dma-pool";
			reg = <0x98000000 0x800000>;
			reusable;
			status = "okay";
		};

		ipu_cma_pool: ipu_cma@98800000 {
			compatible = "shared-dma-pool";
			reg = <0x98800000 0x7000000>;
			reusable;
			status = "okay";
		};
	};

	gpio_keys {
		compatible = "gpio-keys";

		pinctrl-names = "default";
		pinctrl-0 = <
				&lid_key_pins
				&vol_up_key_pins
				&vol_down_key_pins
		>;

		case_lid {
			label = "lid-hall-sensor";
			linux,can-disable;
			linux,input-type = <EV_SW>;
			linux,code = <SW_LID>;
			debounce-interval = <10>;
			gpios = <&gpio1 0 GPIO_ACTIVE_LOW>;
			wakeup-source;
			wakeup-event-action = <EV_ACT_DEASSERTED>;
		};

		volume_up {
			label = "volume-up";
			linux,can-disable;
			linux,code = <KEY_VOLUMEUP>;
			gpios = <&gpio1 1 GPIO_ACTIVE_LOW>;
			wakeup-source;
		};

		volume_down {
			label = "volume-down";
			linux,can-disable;
			linux,code = <KEY_VOLUMEDOWN>;
			gpios = <&gpio2 18 GPIO_ACTIVE_LOW>;
			wakeup-source;
		};
	};

	rfkill_wifi {
		status = "disabled";
		compatible = "rfkill-gpio";
		rfkill-name = "bcm43239";
		rfkill-type = "wlan";
		shutdown-gpios = <&gpio2 11 GPIO_ACTIVE_HIGH>;	/* wlan_en */
	};

	mmc5_pwrseq: wifi_pwrseq {
		compatible = "mmc-pwrseq-simple";

		pinctrl-names = "default";
		pinctrl-0 = <&brcmfmac_vmmc_pins>;

		reset-gpios = <&gpio2 11 GPIO_ACTIVE_LOW>;
	};

	sound1 {
		status = "okay";

		compatible = "ti,jem-audio";
		model = "wm8962-audio";
		ssi-controller = <&mcbsp2>;
		audio-codec = <&wm_codec>;
		audio-routing =	"Headphone", "HPOUTL",
				"Headphone", "HPOUTR",
				"Main Speaker", "SPKOUTL",
				"Main Speaker", "SPKOUTR";

		headset-detect-gpios = <&gpio6 11 GPIO_ACTIVE_LOW>;
	};

	/* backlight PWM */
	pwm10: dmtimer-pwm@10 {
		status = "okay";
		compatible = "ti,omap-dmtimer-pwm";
		ti,timers = <&timer10>;
		ti,prescaler = <0>; /* use ti,clock-source in newer kernels */
		// ti,clock-source = <0x01>;
		#pwm-cells = <3>;
	};

	lcd0_bl: backlight {
		status = "okay";
		compatible = "pwm-backlight";
		pwms = <&pwm10 0 5000000 0>;
		brightness-levels = <0 2 4 6 8 12 16 24 32 48 64 96 128 192 255>;
		default-brightness-level = <6>;

		power-supply = <&vmmc>;
		enable-gpios = <&gpio1 25 GPIO_ACTIVE_HIGH>;
	};

	aliases {
		display0 = &lcd0;
		display1 = &hdmi0;
	};

	tpd12s015: encoder {
		compatible = "ti,tpd12s015";

		pinctrl-names = "default";
		pinctrl-0 = <&tpd12s015_pins>;

		gpios = <&gpio2 28 GPIO_ACTIVE_HIGH>,	/* 60, CT CP HPD */
			<&gpio2 9 GPIO_ACTIVE_HIGH>,	/* 41, LS OE */
			<&gpio2 31 GPIO_ACTIVE_HIGH>;	/* 63, HPD */

		ports {
			#address-cells = <1>;
			#size-cells = <0>;

			port@0 {
				reg = <0>;

				tpd12s015_in: endpoint {
					remote-endpoint = <&hdmi_out>;
				};
			};

			port@1 {
				reg = <1>;

				tpd12s015_out: endpoint {
					remote-endpoint = <&hdmi_connector_in>;
				};
			};
		};
	};

	hdmi0: connector {
		compatible = "hdmi-connector";
		label = "hdmi";

		type = "d";

		port {
			hdmi_connector_in: endpoint {
				remote-endpoint = <&tpd12s015_out>;
			};
		};
	};

	hsusb2_power: hsusb2_power_reg {
		compatible = "regulator-fixed";
		regulator-name = "hsusb2_vbus";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		gpio = <&gpio1 15 GPIO_ACTIVE_LOW>;	/* usb_resume gpio_15 */
		startup-delay-us = <70000>;
		enable-active-high;

		regulator-always-on;
		regulator-boot-on;
	};

	hsusb2_phy: usb-phy@2 {
		compatible = "usb-nop-xceiv";
		reset-gpios = <&gpio2 30 GPIO_ACTIVE_LOW>;   /* gpio_62 */
		#phy-cells = <0>;
		vcc-supply = <&hsusb2_power>;
		clocks = <&auxclk3_ck>;
		clock-names = "main_clk";
		clock-frequency = <19200000>;
	};


	modem_power: modem_power_reg {
		compatible = "regulator-fixed";
		regulator-name = "modem_vbat_power";
		regulator-min-microvolt = <3500000>;
		regulator-max-microvolt = <3500000>;
		gpios = <&gpio2 29 GPIO_ACTIVE_HIGH>;    /* wan_bost_en gpio_61 */
		startup-delay-us = <10000>;
		enable-active-high;
	};

	modem_en: modem {
		compatible = "folksy,3rn13-power";
		pinctrl-names = "default";
		pinctrl-0 = <&modem_pins>;

		feedback-gpios		= <&gpio1 16 GPIO_ACTIVE_HIGH>;
		sim-present-gpios	= <&gpio1 17 GPIO_ACTIVE_HIGH>;
		on-off-gpios		= <&gpio1 18 GPIO_ACTIVE_LOW>;
		reset-gpios		= <&gpio1 19 GPIO_ACTIVE_LOW>;
		usb-en-gpios		= <&gpio1 20 GPIO_ACTIVE_HIGH>;

		// interrupts...
		// host-wake-gpio = <&gpio1 3 GPIO_ACTIVE_HIGH>;
		interrupts = <3 IRQ_TYPE_EDGE_RISING>;	/* gpio_3 trigger_rising */
		interrupt-parent = <&gpio1>;

		modem-supply = <&modem_power>;
		/* VBUS supply should probably be controlled through the USB PHY driver for the modem port */
		usb-port = <&hsusb2_phy>;       /* USB phy where we can check the modem status */
		// vbus-supply = <&modem_vbus_hdmi_power>;

		can-turnoff;
	};
};

&omap4_pmx_wkup {
	pinctrl-names = "default";
	pinctrl-0 = <
		&fref_clk_pins
	>;

	twl6030_wkup_pins: pinmux_twl6030_wkup_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x56, PIN_OUTPUT_PULLUP | MUX_MODE2)	/* fref_clk3_req.sys_drm_msecure */
		>;
	};

	lid_key_pins: pinmux_bu52061_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x40, WAKEUP_EN | PIN_INPUT | MUX_MODE3)	/* gpmc_wk0.gpio_wk0 */
		>;
	};

	vol_up_key_pins: pinmux_vol_up_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x42, WAKEUP_EN | PIN_INPUT_PULLUP | MUX_MODE3)	/* gpmc_wk1.gpio_wk1 */
		>;
	};

	mpu6050_pins: pinmux_mpu6050_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x48, PIN_INPUT | MUX_MODE3)	/* gpio_wk4.gpio_wk4 */
		>;
	};

	fref_clk_pins: pinmux_fref_clk_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x54, PIN_OUTPUT | MUX_MODE0)	/* fref_clk0_out.fref_clk0_out */ // Unknown
			OMAP4_IOPAD(0x58, PIN_OUTPUT | MUX_MODE0)	/* fref_clk3_out.fref_clk3_out */ // USB PHY clock
		>;
	};
};

&omap4_pmx_core {
	pinctrl-names = "default";
	pinctrl-0 = <
		&dmic_pins
		&dss_hdmi_pins
		/* &tpd12s015_pins */
		&backlight_pins
		&nt71391_pins
	>;

	vol_down_key_pins: pinmux_vol_down_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x74, WAKEUP_EN | PIN_INPUT_PULLUP | MUX_MODE3)	/* gpmc_ncs0.gpio_50 */
		>;
	};

	backlight_pins: pinmux_backlight_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x1d0, PIN_OUTPUT | MUX_MODE1)	/* dpm_emu18.dmtimer10_pwm_evt */
			OMAP4_IOPAD(0x1ca, PIN_OUTPUT | MUX_MODE3)	/* dpm_emu14.gpio_25 */
		>;
	};

	nt71391_pins: pinmux_nt71391_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x54, PIN_OUTPUT | MUX_MODE3)	/* gpmc_ad11.gpio_35 */
			OMAP4_IOPAD(0x5a, PIN_OUTPUT | MUX_MODE3)	/* gpmc_ad13.gpio_37 */
		>;
	};

	smb347_pins: pinmux_smb347_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x190, PIN_INPUT | MUX_MODE3)	/* kpd_row1.gpio_2 */
		>;
	};

	cyttsp4_pins: pinmux_cyttsp4_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x1c6, PIN_OUTPUT | MUX_MODE3)	/* dpm_emu12.gpio_23 */
			OMAP4_IOPAD(0x1c8, PIN_INPUT_PULLUP | MUX_MODE3)/* dpm_emu13.gpio_24 */
		>;
	};

	uart2_pins: pinmux_uart2_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x118, PIN_INPUT_PULLUP | MUX_MODE0)	/* uart2_cts.uart2_cts */
			OMAP4_IOPAD(0x11a, PIN_OUTPUT | MUX_MODE0)		/* uart2_rts.uart2_rts */
			OMAP4_IOPAD(0x11c, PIN_INPUT_PULLUP | MUX_MODE0)	/* uart2_rx.uart2_rx */
			OMAP4_IOPAD(0x11e, PIN_OUTPUT | MUX_MODE0)		/* uart2_tx.uart2_tx */
		>;
	};

	uart3_pins: pinmux_uart3_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x140, PIN_INPUT_PULLUP | MUX_MODE0)	/* uart3_cts_rctx.uart3_cts_rctx */
			OMAP4_IOPAD(0x142, PIN_OUTPUT | MUX_MODE0)		/* uart3_rts_sd.uart3_rts_sd */
			OMAP4_IOPAD(0x144, PIN_INPUT | MUX_MODE0)		/* uart3_rx_irrx.uart3_rx_irrx */
			OMAP4_IOPAD(0x146, PIN_OUTPUT | MUX_MODE0)		/* uart3_tx_irtx.uart3_tx_irtx */
		>;
	};

	uart4_pins: pinmux_uart4_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x15c, PIN_INPUT | MUX_MODE0)		/* uart4_rx.uart4_rx */
			OMAP4_IOPAD(0x15e, PIN_OUTPUT | MUX_MODE0)		/* uart4_tx.uart4_tx */
		>;
	};

	twl6030_pins: pinmux_twl6030_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x19e, WAKEUP_EN | PIN_INPUT_PULLUP | MUX_MODE0)	/* sys_nirq1.sys_nirq1 */
		>;
	};

	dmic_pins: pinmux_dmic_pins {
		pinctrl-single,pins = <
			0xd0 (PIN_OUTPUT | MUX_MODE0)		/* abe_dmic_clk1.abe_dmic_clk1 */
			0xd2 (PIN_INPUT | MUX_MODE0)		/* abe_dmic_din1.abe_dmic_din1 */
			0xd4 (PIN_INPUT | MUX_MODE0)		/* abe_dmic_din2.abe_dmic_din2 */
			0xd6 (PIN_INPUT | MUX_MODE0)		/* abe_dmic_din3.abe_dmic_din3 */
		>;
	};

	mcbsp2_pins: pinmux_mcbsp2_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0xf6, PIN_INPUT | MUX_MODE0)	/* abe_mcbsp2_clkx.abe_mcbsp2_clkx */
			OMAP4_IOPAD(0xf8, PIN_INPUT | MUX_MODE0)	/* abe_mcbsp2_dr.abe_mcbsp2_dr */
			OMAP4_IOPAD(0xfa, PIN_OUTPUT | MUX_MODE0)	/* abe_mcbsp2_dx.abe_mcbsp2_dx */
			OMAP4_IOPAD(0xfc, PIN_INPUT | MUX_MODE0)	/* abe_mcbsp2_fsx.abe_mcbsp2_fsx */
		>;
	};

	mmc2_pins_default: pinmux_mmc2_pins_default {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x82, PIN_INPUT_PULLUP | MUX_MODE1)	/* gpmc_noe.sdmmc2_clk */
			OMAP4_IOPAD(0x84, PIN_INPUT_PULLUP | MUX_MODE1)	/* gpmc_nwe.sdmmc2_cmd */
			OMAP4_IOPAD(0x40, PIN_INPUT_PULLUP | MUX_MODE1)	/* gpmc_ad0.sdmmc2_dat0 */
			OMAP4_IOPAD(0x42, PIN_INPUT_PULLUP | MUX_MODE1)	/* gpmc_ad1.sdmmc2_dat1 */
			OMAP4_IOPAD(0x44, PIN_INPUT_PULLUP | MUX_MODE1)	/* gpmc_ad2.sdmmc2_dat2 */
			OMAP4_IOPAD(0x46, PIN_INPUT_PULLUP | MUX_MODE1)	/* gpmc_ad3.sdmmc2_dat3 */
			OMAP4_IOPAD(0x48, PIN_INPUT_PULLUP | MUX_MODE1)	/* gpmc_ad4.sdmmc2_dat4 */
			OMAP4_IOPAD(0x4a, PIN_INPUT_PULLUP | MUX_MODE1)	/* gpmc_ad5.sdmmc2_dat5 */
			OMAP4_IOPAD(0x4c, PIN_INPUT_PULLUP | MUX_MODE1)	/* gpmc_ad6.sdmmc2_dat6 */
			OMAP4_IOPAD(0x4e, PIN_INPUT_PULLUP | MUX_MODE1)	/* gpmc_ad7.sdmmc2_dat7 */
			OMAP4_IOPAD(0x4c, PIN_INPUT_PULLUP | MUX_MODE1)	/* gpmc_ad6.sdmmc2_dat6 */
			OMAP4_IOPAD(0x4e, PIN_INPUT_PULLUP | MUX_MODE1)	/* gpmc_ad7.sdmmc2_dat7 */
		>;
	};

	dss_hdmi_pins: pinmux_dss_hdmi_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x9a, PIN_INPUT | MUX_MODE0)	/* hdmi_cec.hdmi_cec */
			OMAP4_IOPAD(0x9c, PIN_INPUT_PULLUP | MUX_MODE0)	/* hdmi_scl.hdmi_scl */
			OMAP4_IOPAD(0x9e, PIN_INPUT_PULLUP | MUX_MODE0)	/* hdmi_sda.hdmi_sda */
			OMAP4_IOPAD(0x8e, PIN_INPUT_PULLDOWN | MUX_MODE3) /* gpmc_wait2.gpio_100 WTF??? */
		>;
	};

	tpd12s015_pins: pinmux_tpd12s015_pins {
		/* LS_OE, CT_CP_HPD - high to enable dcdc */
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x62, PIN_OUTPUT | MUX_MODE3)		/* gpmc_a17.gpio_41 */
			OMAP4_IOPAD(0x88, PIN_OUTPUT | MUX_MODE3)		/* gpmc_nbe1.gpio_60 */
			OMAP4_IOPAD(0x98, PIN_INPUT_PULLDOWN | MUX_MODE3)	/* hdmi_hpd.gpio_63 */
		>;
	};

	i2c1_pins: pinmux_i2c1_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x122, PIN_INPUT_PULLUP | MUX_MODE0)	/* i2c1_scl */
			OMAP4_IOPAD(0x124, PIN_INPUT_PULLUP | MUX_MODE0)	/* i2c1_sda */
		>;
	};

	i2c2_pins: pinmux_i2c2_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x126, PIN_INPUT_PULLUP | MUX_MODE0)	/* i2c2_scl */
			OMAP4_IOPAD(0x128, PIN_INPUT_PULLUP | MUX_MODE0)	/* i2c2_sda */
		>;
	};

	i2c3_pins: pinmux_i2c3_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x12a, PIN_INPUT_PULLUP | MUX_MODE0)	/* i2c3_scl */
			OMAP4_IOPAD(0x12c, PIN_INPUT_PULLUP | MUX_MODE0)	/* i2c3_sda */
		>;
	};

	i2c4_pins: pinmux_i2c4_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x12e, PIN_INPUT_PULLUP | MUX_MODE0)	/* i2c4_scl */
			OMAP4_IOPAD(0x130, PIN_INPUT_PULLUP | MUX_MODE0)	/* i2c4_sda */
		>;
	};

	bt_pins: pinmux_bt_pins {
		/* RST_N, EN(REG), WAKE, HOST_WAKE */
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x7a, PIN_OUTPUT_PULLUP | MUX_MODE3)	/* gpmc_ncs3.gpio_53 */
			OMAP4_IOPAD(0x6c, PIN_OUTPUT_PULLDOWN | MUX_MODE3)	/* gpmc_a22.gpio_46 */
			OMAP4_IOPAD(0x72, PIN_OUTPUT_PULLDOWN | MUX_MODE3)	/* gpmc_a25.gpio_49 */
			OMAP4_IOPAD(0xbe, PIN_INPUT | MUX_MODE3)		/* cam_strobe.gpio_82 */
		>;
	};

	/* GPIO output for WLAN_EN */
	brcmfmac_vmmc_pins: pinmux_brcmfmac_vmmc_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x66, PIN_OUTPUT | MUX_MODE3)		/* gpmc_a19.gpio_43 */
		>;
	};

	/* brcm GPIO inputs and SDIO pins */
	brcmfmac_pins: pinmux_brcmfmac_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x148, PIN_INPUT_PULLUP | MUX_MODE0)	/* sdmmc5_clk.sdmmc5_clk */
			OMAP4_IOPAD(0x14a, PIN_INPUT_PULLUP | MUX_MODE0)	/* sdmmc5_cmd.sdmmc5_cmd */
			OMAP4_IOPAD(0x14c, PIN_INPUT_PULLUP | MUX_MODE0)	/* sdmmc5_dat0.sdmmc5_dat0 */
			OMAP4_IOPAD(0x14e, PIN_INPUT_PULLUP | MUX_MODE0)	/* sdmmc5_dat1.sdmmc5_dat1 */
			OMAP4_IOPAD(0x150, PIN_INPUT_PULLUP | MUX_MODE0)	/* sdmmc5_dat2.sdmmc5_dat2 */
			OMAP4_IOPAD(0x152, PIN_INPUT_PULLUP | MUX_MODE0)	/* sdmmc5_dat3.sdmmc5_dat3 */
		>;
	};

	usb_otg_hs_pins: pinmux_usb_otg_hs_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x194, PIN_OUTPUT_PULLDOWN | MUX_MODE0)	/* usba0_otg_ce */
			OMAP4_IOPAD(0x196, PIN_INPUT | MUX_MODE0)		/* usba0_otg_dp */
			OMAP4_IOPAD(0x198, PIN_INPUT | MUX_MODE0)		/* usba0_otg_dm */
		>;
	};

	wm8962_pins: pinmux_wm8962_pins {
		/* IRQ, HP_DETECT, MCLK */
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x1cc, PIN_INPUT_PULLDOWN | MUX_MODE3)	/* dpm_emu15.gpio_26 */
			OMAP4_IOPAD(0x17c, PIN_INPUT_PULLUP | MUX_MODE3)	/* kpd_col4.gpio_171 */
			// OMAP4_IOPAD(0x1a0, PIN_INPUT_PULLUP | MUX_MODE0)	/* sys_nirq2.sys_nirq2 probably only used for twl6040... to wake cpu up */

			/* codec mclk - auxclk0_ck out */
			OMAP4_IOPAD(0x19a, PIN_OUTPUT | MUX_MODE0)		/* fref_clk1_out.fref_clk1_out */
		>;
	};

	modem_pins: pinmux_modem_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x192, PIN_INPUT_PULLDOWN | MUX_MODE3)	/* kpd_row2.gpio_3 host_wake */
			OMAP4_IOPAD(0x1b6, PIN_OUTPUT_PULLDOWN | MUX_MODE3)	/* dpm_emu4.gpio_15 usb_resume/host_hmi phy? */
			OMAP4_IOPAD(0x1b8, PIN_INPUT_PULLDOWN | MUX_MODE3)	/* dpm_emu5.gpio_16 fw_ready */
			OMAP4_IOPAD(0x1ba, PIN_INPUT | MUX_MODE3)		/* dpm_emu6.gpio_17 sim_present */
			OMAP4_IOPAD(0x1bc, PIN_OUTPUT | MUX_MODE3)		/* dpm_emu7.gpio_18 wan_on_off */
			OMAP4_IOPAD(0x1be, PIN_OUTPUT_PULLUP | MUX_MODE3)	/* dpm_emu8.gpio_19 resetin_n */
			OMAP4_IOPAD(0x1c0, PIN_OUTPUT_PULLDOWN | MUX_MODE3)	/* dpm_emu9.gpio_20 usb_enable */

			OMAP4_IOPAD(0x8a, PIN_OUTPUT_PULLDOWN | MUX_MODE3)	/* gpmc_wait0.gpio_61 boost_en */
			OMAP4_IOPAD(0x8c, PIN_OUTPUT_PULLUP | MUX_MODE3)	/* gpmc_wait1.gpio_62 usb_phy_nreset */
		>;
	};
};

&i2c1 {
	// We need i2c1 muxed early on the boot process for pmic
	// bootloader already done it for us
	// pinctrl-names = "default";
	// pinctrl-0 = <&i2c1_pins>;

	clock-frequency = <400000>;

	twl: twl@48 {
		reg = <0x48>;

		pinctrl-names = "default";
		pinctrl-0 = <
			&twl6030_pins
			&twl6030_wkup_pins
		>;

		/* SPI = 0, IRQ# = 7, 4 = active high level-sensitive */
		interrupts = <GIC_SPI 7 IRQ_TYPE_LEVEL_HIGH>; /* IRQ_SYS_1N cascaded to gic */
		interrupt-parent = <&gic>;
	};
};

#include "twl6030.dtsi"

&twl {
	compatible = "ti,twl6032";

	twl_pwrbutton: pwrbutton {
		compatible = "ti,twl6030-pwrbutton";
		interrupts = <0>;
	};

	/* wifi */
	vaux1: regulator-vaux1 {
		compatible = "ti,twl6032-ldo2";
		regulator-min-microvolt = <1000000>;
		regulator-max-microvolt = <3000000>;
		// regulator-always-on;
	};

	/* DSS, DSI what? panel? controller? */
	vcxio: regulator-vcxio {
		compatible = "ti,twl6032-ldo6";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
	};

	/* mmc and backlight? and wifi?*/
	vmmc: regulator-vmmc {
		compatible = "ti,twl6032-ldo5";
		regulator-min-microvolt = <1200000>;
		regulator-max-microvolt = <3000000>;
	};

	/* ???? Supposed to be for OTG, seems to be not used */
	vusb: regulator-vusb {
		compatible = "ti,twl6032-ldousb";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		// regulator-always-on;

		status = "disabled";
	};

	/* presumably wm8962 */
	vaux2: regulator-vaux2 {
		compatible = "ti,twl6032-ldo4";
		regulator-min-microvolt = <1200000>;
		regulator-max-microvolt = <2800000>;
		// regulator-always-on;
	};

	/* smb347 */
	vusim: regulator-vusim {
		compatible = "ti,twl6032-ldo7";
		regulator-min-microvolt = <1200000>;
		regulator-max-microvolt = <2900000>;
	};

	/* ???? */
	clk32kg: regulator-clk32kg {
		compatible = "ti,twl6030-clk32kg";
		regulator-always-on;
	};

	/* Bluetooth clock */
	clk32kaudio: regulator-clk32kaudio {
		compatible = "ti,twl6030-clk32kaudio";
	};

	/* HDMI vref */
	vdac: regulator-vdac {
		compatible = "ti,twl6032-ldoln";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
	};

	/* ???? */
	vana: regulator-vana {
		compatible = "ti,twl6030-vana";
		regulator-always-on;
	};

	/*
	vaux1 - ldo2 - Wi-Fi, or not....
	vaux2 - ldo4 - wm8962, definitely not, not enabled on stock
	vaux3 - ldo3 - Cam2!
	 vmmc - ldo5 - nope, disabled
	  vpp - ldo1 ??? disabled
	 vana - ???
	vcxio - ldo6 - dss,dsi
	 vdac - ldoln - hdmi-vref!
	 vusb - ldousb ???
	vusim - ldo7 - smb347
	clk32kg - clk32kg ??? not used?
	*/
};

/* &twl {
	compatible = "ti,twl6032";
	interrupt-controller;
	#interrupt-cells = <1>;

	rtc {
		compatible = "ti,twl4030-rtc";
		interrupts = <11>;
	};

	vaux1: regulator-vaux1 {
		compatible = "ti,twl6032-ldo2";
		regulator-min-microvolt = <1000000>;
		regulator-max-microvolt = <3000000>;
		regulator-always-on;
	};

	vaux3: regulator-vaux3 {
		compatible = "ti,twl6032-ldo3";
		regulator-min-microvolt = <1000000>;
		regulator-max-microvolt = <3000000>;
	};

	vmmc: regulator-vmmc {
		compatible = "ti,twl6032-ldo5";
		regulator-min-microvolt = <1200000>;
		regulator-max-microvolt = <3000000>;
	};

	vpp: regulator-vpp {
		compatible = "ti,twl6032-ldo1";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <2500000>;
	};

	vusim: regulator-vusim {
		compatible = "ti,twl6032-ldo7";
		regulator-min-microvolt = <1200000>;
		regulator-max-microvolt = <2900000>;
	};

	vdd_mpu: regulator-vdd1 {
		compatible = "ti,twl6030-vdd1";
		regulator-min-microvolt = <500000>;
		regulator-max-microvolt = <1500000>;
	};

	vdd_iva: regulator-vdd2 {
		compatible = "ti,twl6030-vdd2";
		regulator-min-microvolt = <500000>;
		regulator-max-microvolt = <1500000>;
	};

	vdd_core: regulator-vdd3 {
		compatible = "ti,twl6030-vdd3";
		regulator-min-microvolt = <500000>;
		regulator-max-microvolt = <1500000>;
	};

	vdac: regulator-vdac {
		compatible = "ti,twl6032-vdoln";
	};

	vana: regulator-vana {
		compatible = "ti,twl6030-vana";
	};

	ldo6: regulator-ldo6 {
		compatible = "ti,twl6032-ldo6";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
	};

	vusb: regulator-vusb {
		compatible = "ti,twl6032-ldousb";
	};

	v1v8: regulator-v1v8 {
		compatible = "ti,twl6030-v1v8";
		regulator-always-on;
	};

	v2v1: regulator-v2v1 {
		compatible = "ti,twl6030-v2v1";
		regulator-always-on;
	};

	twl_usb_comparator: usb-comparator {
		compatible = "ti,twl6030-usb";
		interrupts = <4>, <10>;
	};

	gpadc {
		compatible = "ti,twl6030-gpadc";
		interrupts = <3>;
		#io-channel-cells = <1>;
	};
}; */

&i2c2 {
	pinctrl-names = "default";
	pinctrl-0 = <&i2c2_pins>;
	clock-frequency = <400000>;

	cypress@67 {
		compatible = "cy,cyttsp4-i2c";
		reg = <0x67>;

		pinctrl-names = "default";
		pinctrl-0 = <&cyttsp4_pins>;

		interrupt-parent = <&gpio1>;
		interrupts = <24 IRQ_TYPE_LEVEL_LOW>;

		irq-delay = <0>;

		tch-address = <0x67>;
		ldr-address = <0x69>;

		reset-gpios = <&gpio1 23 GPIO_ACTIVE_HIGH>;
		irq-gpios = <&gpio1 24 GPIO_ACTIVE_HIGH>;

		input-name = "cyttsp4_i2c_adapter";
		// touchscreen-size-x = <800>;
		// touchscreen-size-y = <480>;
		// touchscreen-fuzz-x = <4>;
		// touchscreen-fuzz-y = <7>;
		// bootloader-key = /bits/ 8 <0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08>;
		// active-distance = <8>;
		// active-interval-ms = <0>;
		// lowpower-interval-ms = <200>;
		// touch-timeout-ms = <100>;
	};
};

&i2c3 {
	pinctrl-names = "default";
	pinctrl-0 = <&i2c3_pins>;
	clock-frequency = <400000>;

	bq27541@55 {
		compatible = "ti,bq27541";
		reg = <0x55>;
	};

	/*
	 * Temperature Sensor
	 */
	tmp103@70 {
		compatible = "ti,tmp103";
		reg = <0x70>;
	};

	smb347@5f {
		status = "okay";
		compatible = "summit,smb347";
		reg = <0x5f>;

		pinctrl-names = "default";
		pinctrl-0 = <&smb347_pins>;

		interrupts = <2 IRQ_TYPE_EDGE_FALLING>;	/* gpio_2 trigger_rising */
		interrupt-parent = <&gpio1>;

		power-supply = <&vusim>;

		max-chg-curr = <1800000>;
		pre-chg-curr = <250000>;
		term-curr = <250000>;
		mains-curr-limit = <2000000>;
		usb-curr-limit = <450000>;
		chip-temp-thershold = <100>;

		enable-usb-charging;
		enable-otg-charging = <4>; /* CONTROL_SW_PIN */
		enable-chg-ctrl = <0>;
	};

	wm_codec: wm8962@1a {
		#sound-dai-cells = <0>;
		compatible = "wlf,wm8962";
		reg = <0x1a>;

		pinctrl-names = "default";
		pinctrl-0 = <&wm8962_pins>;

		/* IRQ is not working properly for some reason */
		// interrupts = <26 IRQ_TYPE_LEVEL_HIGH>;
		// interrupt-parent = <&gpio1>;

		clocks = <&auxclk0_ck>;
		clock-names = "main_clk";
		clock-frequency = <19200000>;

		gpio-cfg = <
			0x0000 /* 0:Default */
			0x0003 /* 1:FN_IRQ */
			0x0000 /* 2:Default */
			0x0000 /* 3:Default */
			0x8014 /* 4:FN_DMICCDAT */
			0x0013 /* 5:FN_DMICCLK */
		>;

		mic-cfg = <1>;
	};
};

&i2c4 {
	pinctrl-names = "default";
	pinctrl-0 = <&i2c4_pins>;
	clock-frequency = <400000>;

	mpu6050@68 {
		compatible = "invensense,mpu6050";
		reg = <0x68>;

		pinctrl-names = "default";
		pinctrl-0 = <&mpu6050_pins>;

		interrupt-parent = <&gpio1>;
		interrupts = <4 IRQ_TYPE_EDGE_RISING>;

		/* x0, y0, z0,
		 * x1, y1, z1,
		 * x2, y2, z2 */
		mount-matrix =	"0",	"-1",	"0",
				"1",	"0",	"0",
				"0",	"0",	"1";
	};
};

&mmc1 {
	status = "disabled";
};

&mmc2 {
	status = "okay";

	pinctrl-names = "default";
	pinctrl-0 = <&mmc2_pins_default>;

	vmmc-supply = <&vmmc>;
	bus-width = <8>;
	non-removable;
	ti,non-removable;

	cd-gpios = <&gpio2 1 GPIO_ACTIVE_LOW>;
	wp-gpios = <&gpio2 2 GPIO_ACTIVE_HIGH>;
};

&mmc3 {
	status = "disabled";
};

&mmc4 {
	status = "disabled";
};

&mmc5 {
	status = "disabled";

	pinctrl-names = "default";
	pinctrl-0 = <&brcmfmac_pins>;

	vmmc-supply = <&vaux1>;
	mmc-pwrseq = <&mmc5_pwrseq>;

	mmc-ddr-1_8v;
	mmc-ddr-1_2v;

	keep-power-in-suspend;

	bus-width = <4>;
	non-removable;
	ti,non-removable;

	#address-cells = <1>;
	#size-cells = <0>;
	brcmf: bcrmf@1 {
		reg = <1>;
		compatible = "brcm,bcm4329-fmac";
		interrupt-parent = <&gpio2>;
		interrupts = <12 IRQ_TYPE_LEVEL_HIGH>;
		interrupt-names = "host-wake";
		brcm,drive-strength = <6>;
	};
};

&emif1 {
	cs1-used;
	device-handle = <&elpida_ECB240ABACN>;
};

&emif2 {
	cs1-used;
	device-handle = <&elpida_ECB240ABACN>;
};

&uart2 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart2_pins>;
	interrupts-extended = <&wakeupgen GIC_SPI 73 IRQ_TYPE_LEVEL_HIGH
				&omap4_pmx_core OMAP4_UART2_RX>;

	bluetooth {
		status = "okay";
		compatible = "brcm,bcm2076-bt";
		pinctrl-names = "default";
		pinctrl-0 = <&bt_pins>;

		vddio-supply = <&clk32kaudio>;

		interrupt-parent = <&gpio4>;
		interrupts = <18 IRQ_TYPE_LEVEL_HIGH>;

		max-speed = <3692000>;

		shutdown-gpios = <&gpio2 14 GPIO_ACTIVE_HIGH>;
		device-wakeup-gpios = <&gpio2 17 GPIO_ACTIVE_HIGH>;
	};
};

&uart3 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart3_pins>;
	interrupts-extended = <&wakeupgen GIC_SPI 74 IRQ_TYPE_LEVEL_HIGH
				&omap4_pmx_core OMAP4_UART3_RX>;
};

&uart4 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart4_pins>;
	interrupts-extended = <&wakeupgen GIC_SPI 70 IRQ_TYPE_LEVEL_HIGH
				&omap4_pmx_core OMAP4_UART4_RX>;
};

&mcbsp2 {
	#sound-dai-cells = <0>;
	pinctrl-names = "default";
	pinctrl-0 = <&mcbsp2_pins>;
	status = "okay";
};

&mcbsp3 {
	// To be used for Bluetooth
	status = "disabled";
};

&dmic {
	pinctrl-names = "default";
	pinctrl-0 = <&dmic_pins>;
	status = "okay";
};

&usbhsehci {
	phys = <&hsusb2_phy>;
};

&usbhshost {
	port2-mode = "ehci-phy";
};

&twl_usb_comparator {
	usb-supply = <&vusb>;
};

&usb_otg_hs {
/*	pinctrl-names = "default";
	pinctrl-0 = <&usb_otg_hs_pins>;*/

	interface-type = <1>;
	mode = <3>;
	power = <50>;
};

&dss {
	status = "ok";
};

&dsi1 {
	status = "ok";
	vdd-supply = <&vcxio>;

	port {
		dsi1_out_ep: endpoint {
			remote-endpoint = <&lcd0_in>;
			lanes = <
				4 5
				0 1
				2 3
				6 7
				8 9
			>;
		};
	};

	lcd0: display {
		compatible = "hydis,nt71391";
		label = "lcd0";

		enable-gpios = <&gpio2 3 GPIO_ACTIVE_HIGH>;
		cabc-gpios = <&gpio2 5 GPIO_ACTIVE_HIGH>;

		backlight = <&lcd0_bl>;

		port {
			lcd0_in: endpoint {
				remote-endpoint = <&dsi1_out_ep>;
			};
		};
	};
};

&hdmi {
	status = "ok";
	vdda-supply = <&vdac>;

	port {
		hdmi_out: endpoint {
			remote-endpoint = <&tpd12s015_in>;
		};
	};
};

&bb2d {
	status = "okay";
};

&sgx {
	status = "okay";
};

/* &dsp {
	status = "okay";
	memory-region = <&dsp_cma_pool>;
	timers = <&timer5>;
	watchdog-timers = <&timer6>;
};

&ipu {
	status = "okay";
	memory-region = <&ipu_cma_pool>;
	timers = <&timer3>;
	watchdog-timers = <&timer9>, <&timer11>;
}; */
